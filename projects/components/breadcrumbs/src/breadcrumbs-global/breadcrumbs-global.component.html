<emr-breadcrumbs [lastItemAsLink]="lastItemAsLink()">
  @for (breadcrumb of breadcrumbs(); track $index; let last = $last) {
    @switch (breadcrumb.type) {
      @case ('link') {
        <a emr-breadcrumb-item [routerLink]="breadcrumb.route">
          <ng-container emrBreadcrumbItemIcon>
            @if (iconTemplateRef) {
              <ng-container [ngTemplateOutlet]="iconTemplateRef"
                            [ngTemplateOutletContext]="{ $implicit: breadcrumb }"/>
            } @else {
              @if (breadcrumb.icon) {
                <mat-icon>{{ breadcrumb.icon }}</mat-icon>
              }
            }
          </ng-container>

          @if (titleTemplateRef) {
            <emr-breadcrumb-title>
              <ng-container [ngTemplateOutlet]="titleTemplateRef"
                            [ngTemplateOutletContext]="{ $implicit: breadcrumb }"/>
            </emr-breadcrumb-title>
          } @else {
            @if (breadcrumb.title) {
              <emr-breadcrumb-title>{{ breadcrumb.title }}</emr-breadcrumb-title>
            }
          }

          @if (nameTemplateRef) {
            <ng-container [ngTemplateOutlet]="nameTemplateRef"
                          [ngTemplateOutletContext]="{ $implicit: breadcrumb }"/>
          } @else {
            @if (breadcrumb.name) {
              {{ breadcrumb.name }}
            }
          }
        </a>
      }
      @default {
        <emr-breadcrumb-item>
          <ng-container emrBreadcrumbItemIcon>
            @if (breadcrumb.icon) {
              @if (itemIconDef()) {
                <ng-container [ngTemplateOutlet]="iconTemplateRef"
                              [ngTemplateOutletContext]="{ $implicit: breadcrumb.icon, breadcrumb }"/>
              } @else {
                <mat-icon>{{ breadcrumb.icon }}</mat-icon>
              }
            }
          </ng-container>

          @if (titleTemplateRef) {
            <emr-breadcrumb-title>
              <ng-container [ngTemplateOutlet]="titleTemplateRef"
                            [ngTemplateOutletContext]="{ $implicit: breadcrumb }"/>
            </emr-breadcrumb-title>
          } @else {
            @if (breadcrumb.title) {
              <emr-breadcrumb-title>{{ breadcrumb.title }}</emr-breadcrumb-title>
            }
          }

          @if (nameTemplateRef) {
            <ng-container [ngTemplateOutlet]="nameTemplateRef"
                          [ngTemplateOutletContext]="{ $implicit: breadcrumb }"/>
          } @else {
            @if (breadcrumb.name) {
              {{ breadcrumb.name }}
            }
          }
        </emr-breadcrumb-item>
      }
    }

    @if (!last) {
      <emr-breadcrumb-separator>{{ separator() }}</emr-breadcrumb-separator>
    }
  }
</emr-breadcrumbs>
